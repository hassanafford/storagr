# 📁 ملفات قاعدة البيانات - Supabase SQL Files

## 🎯 الملف الموصى به للاستخدام

### ✅ `complete_setup.sql` - الإعداد الكامل (موصى به)

**هذا هو الملف الذي يجب استخدامه!**

يحتوي على كل شيء في ملف واحد:
- ✅ تنظيف كامل للجداول القديمة
- ✅ إنشاء جميع الجداول (warehouses, users, items, transactions, notifications, etc.)
- ✅ إضافة 12 مخزن + 13 مستخدم (1 admin + 12 employee)
- ✅ إعداد Functions و Triggers
- ✅ تفعيل Row Level Security
- ✅ إنشاء Views مفيدة
- ✅ رسائل تحقق من النجاح

**كيفية الاستخدام:**
1. افتح Supabase Dashboard → SQL Editor
2. انسخ محتوى `complete_setup.sql`
3. الصق في SQL Editor
4. اضغط Run
5. انتظر 10-15 ثانية
6. ستظهر رسالة نجاح مع الإحصائيات

---

## 📄 الملفات الأخرى (اختيارية)

### `cleanup.sql` - التنظيف فقط
- يحذف جميع الجداول والـ Views والـ Functions القديمة
- استخدمه فقط إذا كنت تريد التنظيف بدون إعادة الإنشاء
- ⚠️ تحذير: سيحذف جميع البيانات!

### `schema.sql` - الإنشاء فقط
- ينشئ الجداول والبيانات بدون تنظيف
- استخدمه فقط إذا كانت قاعدة البيانات فارغة
- يحتوي على نفس البيانات الموجودة في `complete_setup.sql`

---

## 📊 البيانات المُدرجة

### المخازن (12 مخزن):
1. المخزن الرئيسي
2. مخزن المختبر
3. مخزن المكتبة
4. مخزن الملابس
5. مخزن الأثاث
6. مخزن الإلكترونيات
7. مخزن الأدوات
8. مخزن المواد الغذائية
9. مخزن التنظيف
10. مخزن الرياضة
11. مخزن الفنون
12. مخزن الإسعافات

### المستخدمون (13 مستخدم):
- **1 مسؤول (Admin):**
  - الرقم القومي: `12345678901234`
  - كلمة المرور: `901234`
  - لا يرتبط بمخزن محدد (يرى جميع المخازن)

- **12 موظف (Employee):**
  - كل موظف مرتبط بمخزن واحد
  - كلمة المرور = آخر 6 أرقام من الرقم القومي
  - مثال: `11111111111111` → كلمة المرور: `111111`

### الفئات (7 فئات):
1. قرطاسية
2. أثاث
3. إلكترونيات
4. نظافة
5. كتب
6. رياضة
7. مختبرات

### أصناف تجريبية (7 أصناف):
- أقلام جاف أزرق (500 قلم)
- دفاتر 100 ورقة (300 دفتر)
- مكاتب خشبية (50 قطعة)
- كراسي بلاستيك (100 قطعة)
- أجهزة كمبيوتر (25 جهاز)
- مواد تنظيف (150 عبوة)
- كتب رياضيات (200 كتاب)

---

## 🔧 ما يتم إنشاؤه

### الجداول (7 جداول):
- `warehouses` - المخازن
- `categories` - الفئات
- `users` - المستخدمون
- `items` - الأصناف
- `transactions` - المعاملات
- `notifications` - الإشعارات
- `audit_logs` - سجل التدقيق

### Functions (5 دوال):
- `get_egyptian_time()` - الحصول على الوقت المصري
- `update_updated_at_column()` - تحديث وقت التعديل تلقائياً
- `check_low_stock()` - فحص المخزون المنخفض
- `log_quantity_change()` - تسجيل تغييرات الكمية
- `get_warehouse_stats()` - حساب إحصائيات المخزن

### Triggers (5 محفزات):
- تحديث `updated_at` تلقائياً على الجداول
- فحص المخزون المنخفض وإرسال إشعارات

### Views (3 عروض):
- `items_full_view` - عرض الأصناف مع معلومات كاملة
- `transactions_full_view` - عرض المعاملات مع معلومات كاملة
- `low_stock_items_view` - عرض الأصناف ذات المخزون المنخفض

### Indexes (14 فهرس):
- فهارس على الأعمدة المهمة لتحسين الأداء

### Row Level Security:
- سياسات أمان على جميع الجداول
- حالياً مفتوحة للتطوير (`USING true`)
- يجب تشديدها للإنتاج لاحقاً

---

## ⚠️ ملاحظات مهمة

1. **التنفيذ:**
   - استخدم `complete_setup.sql` فقط
   - لا تنفذ `cleanup.sql` و `schema.sql` معاً

2. **Realtime:**
   - يجب تفعيله يدوياً من Dashboard
   - Database > Replication > Enable
   - فعّل على: items, transactions, notifications, users, warehouses

3. **الأمان:**
   - السياسات الحالية مفتوحة للتطوير
   - يجب تشديدها قبل الإنتاج
   - استخدم JWT tokens في الإنتاج

4. **البيانات:**
   - البيانات المُدرجة هي بيانات حقيقية للمشروع
   - 12 مخزن + 13 مستخدم
   - يمكن إضافة المزيد من الأصناف لاحقاً

---

## 🚀 الخطوات التالية

بعد تنفيذ `complete_setup.sql`:

1. ✅ تفعيل Realtime على الجداول
2. ✅ نسخ SUPABASE_URL و SUPABASE_ANON_KEY
3. ✅ إضافتهم في ملف `.env`
4. ✅ تشغيل المشروع محلياً
5. ✅ اختبار تسجيل الدخول
6. ✅ النشر على Vercel

---

## 📞 للدعم

راجع ملف `SETUP_INSTRUCTIONS.txt` في المجلد الرئيسي للحصول على تعليمات مفصلة.

---

**تم إنشاء هذه الملفات بواسطة نظام إدارة مخازن المدرسة**